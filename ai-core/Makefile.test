#!/bin/bash
# ============================================================================
# AI-CORE TEST MAKEFILE
# ============================================================================
# Convenient makefile-like commands for running tests.
# This provides simple shortcuts for common testing tasks.
#
# Usage:
#   source Makefile.test   # Load functions into current shell
#   make-test             # Run all tests
#   make-test-integration # Run integration tests only
#   make-test-unit        # Run unit tests only
#   make-test-validation  # Run validation tests only
# ============================================================================

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m'

# ============================================================================
# TEST COMMANDS
# ============================================================================

# Run all tests
make-test() {
    echo -e "${CYAN}Running all tests...${NC}"
    bash ./tests/run-all-tests.sh "$@"
}

# Run integration tests only
make-test-integration() {
    echo -e "${CYAN}Running integration tests...${NC}"
    bash ./tests/run-all-tests.sh --suite integration "$@"
}

# Run unit tests only
make-test-unit() {
    echo -e "${CYAN}Running unit tests...${NC}"
    bash ./tests/run-all-tests.sh --suite unit "$@"
}

# Run validation tests only
make-test-validation() {
    echo -e "${CYAN}Running validation tests...${NC}"
    bash ./tests/run-all-tests.sh --suite validation "$@"
}

# Run tests with verbose output
make-test-verbose() {
    echo -e "${CYAN}Running tests with verbose output...${NC}"
    bash ./tests/run-all-tests.sh --verbose "$@"
}

# Run tests and keep artifacts for debugging
make-test-debug() {
    echo -e "${CYAN}Running tests with debug artifacts...${NC}"
    export KEEP_TEST_ARTIFACTS=true
    bash ./tests/run-all-tests.sh --verbose "$@"
}

# Run tests and generate JUnit XML reports
make-test-ci() {
    echo -e "${CYAN}Running tests for CI/CD...${NC}"
    mkdir -p ./tests/reports/xml
    bash ./tests/run-all-tests.sh --xml-output ./tests/reports/xml "$@"
}

# Quick test (run only fast tests)
make-test-quick() {
    echo -e "${CYAN}Running quick tests...${NC}"
    # Run unit tests only (fastest)
    bash ./tests/run-all-tests.sh --suite unit "$@"
}

# Full test suite
make-test-full() {
    echo -e "${CYAN}Running full test suite...${NC}"
    bash ./tests/run-all-tests.sh --verbose --keep-artifacts "$@"
}

# Show test help
make-test-help() {
    echo -e "${BOLD}${CYAN}AI-Core Test Commands${NC}"
    echo ""
    echo "Available commands:"
    echo ""
    echo -e "  ${GREEN}make-test${NC}              Run all tests"
    echo -e "  ${GREEN}make-test-integration${NC}  Run integration tests only"
    echo -e "  ${GREEN}make-test-unit${NC}         Run unit tests only"
    echo -e "  ${GREEN}make-test-validation${NC}   Run validation tests only"
    echo -e "  ${GREEN}make-test-verbose${NC}      Run with verbose output"
    echo -e "  ${GREEN}make-test-debug${NC}        Run and keep artifacts"
    echo -e "  ${GREEN}make-test-ci${NC}           Run and generate JUnit XML"
    echo -e "  ${GREEN}make-test-quick${NC}        Run quick tests (unit only)"
    echo -e "  ${GREEN}make-test-full${NC}         Run full test suite with verbose"
    echo -e "  ${GREEN}make-test-help${NC}         Show this help message"
    echo ""
    echo "Examples:"
    echo ""
    echo "  make-test                  # Run all tests"
    echo "  make-test-integration      # Run only integration tests"
    echo "  make-test-debug            # Run with debugging enabled"
    echo "  make-test-ci --verbose     # CI/CD with verbose output"
    echo ""
    echo "Environment variables:"
    echo ""
    echo "  AI_CORE_PATH              Path to ai-core directory"
    echo "  VERBOSE                   Enable verbose output (true/false)"
    echo "  KEEP_TEST_ARTIFACTS       Keep test artifacts (true/false)"
    echo ""
}

# ============================================================================
# DIRECT SCRIPT EXECUTION
# ============================================================================

# If script is executed (not sourced), run the command
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    case "${1:-help}" in
        all)
            make-test "${@:2}"
            ;;
        integration)
            make-test-integration "${@:2}"
            ;;
        unit)
            make-test-unit "${@:2}"
            ;;
        validation)
            make-test-validation "${@:2}"
            ;;
        verbose)
            make-test-verbose "${@:2}"
            ;;
        debug)
            make-test-debug "${@:2}"
            ;;
        ci)
            make-test-ci "${@:2}"
            ;;
        quick)
            make-test-quick "${@:2}"
            ;;
        full)
            make-test-full "${@:2}"
            ;;
        help|--help|-h)
            make-test-help
            ;;
        *)
            echo "Unknown command: $1"
            echo ""
            make-test-help
            exit 1
            ;;
    esac
fi
